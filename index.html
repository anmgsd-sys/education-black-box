<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Education Black Box: Methodology Expert</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body {
            font-family: 'Times New Roman', serif;
            background-color: #f4f6f9; color: #333;
            text-align: center; padding: 20px; margin: 0;
        }
        .container { max-width: 950px; margin: 20px auto; }
        .card {
            background-color: #ffffff; padding: 30px; border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15); border-top: 6px solid #2c3e50;
        }
        h1 { color: #2c3e50; margin: 0; font-family: sans-serif; }
        
        /* –ë–∞—Ç—ã—Ä–º–∞–ª–∞—Ä */
        .btn {
            padding: 12px 20px; font-size: 16px; font-weight: bold;
            border: none; border-radius: 6px; cursor: pointer; margin: 10px;
            color: white; transition: 0.2s;
        }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .start { background-color: #27ae60; }
        .stop { background-color: #c0392b; }
        .download { background-color: #2980b9; width: 48%; }
        .audio-btn { background-color: #16a085; width: 48%; }
        .btn:disabled { background-color: #bdc3c7; cursor: not-allowed; transform: none; }

        /* –ò–ù–î–ò–ö–ê–¢–û–†–õ–ê–† */
        .speaker-box {
            margin: 15px auto; padding: 15px; width: 80%;
            background-color: #ecf0f1; color: #7f8c8d;
            font-size: 20px; font-weight: bold; border-radius: 8px;
            border: 2px solid #bdc3c7; transition: 0.3s;
        }
        /* –°—Ç–∞—Ç—É—Å—Ç–∞—Ä–¥—ã“£ —Ç“Ø—Å—Ç–µ—Ä—ñ */
        .teacher-mode { background-color: #d5f5e3; color: #1e8449; border-color: #2ecc71; text-align: left; padding-left: 20px;}
        .student-mode { background-color: #fcf3cf; color: #b7950b; border-color: #f1c40f; text-align: right; padding-right: 20px;}
        .group-mode { background-color: #d6eaf8; color: #2874a6; border-color: #3498db; text-align: center;} /* –¢–æ–ø—Ç—ã“õ */
        .individual-mode { background-color: #eaecee; color: #566573; border-color: #808b96; text-align: center; font-style: italic;} /* –ñ–µ–∫–µ */

        #audioVisualizer {
            width: 100%; height: 100px; background-color: #2c3e50;
            border-radius: 8px; margin-top: 10px;
        }

        /* –¢—ñ—Ä–∫–µ–ª—É —Ç–µ—Ä–µ–∑–µ—Å—ñ */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex; z-index: 9999;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 40px; border-radius: 8px; width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center;
        }
        input {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px;
        }
        
        .hidden { display: none !important; }
        .blur { filter: blur(8px); pointer-events: none; }

        /* PDF –î–∏–∑–∞–π–Ω—ã */
        #analysisResult {
            text-align: left; padding: 30px; 
            font-family: 'Times New Roman', serif;
            background-color: white; color: black;
            overflow: visible !important; height: auto !important;
        }
        .report-section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .report-title { font-weight: bold; font-size: 14pt; color: #2c3e50; margin-bottom: 10px; background: #ecf0f1; padding: 5px;}
        .timeline-item { margin-bottom: 5px; font-size: 12pt; }
    </style>
</head>
<body>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#2c3e50; margin-top:0;">üîê –°–∞–±–∞“õ—Ç—ã –±–∞—Å—Ç–∞—É</h2>
            <p>–î–µ—Ä–µ–∫—Ç–µ—Ä —Ö–∞—Ç—Ç–∞–º–∞“ì–∞ –∂–∞–∑—ã–ª–∞–¥—ã</p>
            <input type="text" id="teacherNameInput" placeholder="–ú“±“ì–∞–ª—ñ–º–Ω—ñ“£ –ê—Ç—ã-–ñ”©–Ω—ñ">
            <input type="text" id="subjectInput" placeholder="–ü”ô–Ω (–ú—ã—Å–∞–ª—ã: –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞)">
            <input type="text" id="gradeInput" placeholder="–°—ã–Ω—ã–ø (–ú—ã—Å–∞–ª—ã: 8–ê)">
            <input type="text" id="topicInput" placeholder="–°–∞–±–∞“õ —Ç–∞“õ—ã—Ä—ã–±—ã">
            <button class="btn start" onclick="saveData()" style="width:100%">–†–∞—Å—Ç–∞—É</button>
        </div>
    </div>

    <div class="container blur" id="mainContainer">
        <div class="card">
            <h1>Education Black Box</h1>
            <p style="color:#7f8c8d; margin-top:0;">Advanced Pedagogical Analysis System</p>
            
            <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px; border:1px solid #ddd;">
                üë§ <b>–ú“±“ì–∞–ª—ñ–º:</b> <span id="displayTeacher">...</span> <br>
                üìö <b>–ü”ô–Ω:</b> <span id="displaySubject">...</span> | üìù <b>–¢–∞“õ—ã—Ä—ã–ø:</b> <span id="displayTopic">...</span>
            </div>

            <div class="controls">
                <button id="startBtn" class="btn start" onclick="startAnalysis()" disabled>üéô –°–∞–±–∞“õ—Ç—ã –±–∞—Å—Ç–∞—É</button>
                <button id="stopBtn" class="btn stop" onclick="stopAnalysis()" disabled>üõë –ê—è“õ—Ç–∞—É</button>
            </div>

            <div id="speakerIndicator" class="speaker-box">–ö“Ø—Ç—É —Ä–µ–∂–∏–º—ñ...</div>
            <canvas id="audioVisualizer"></canvas>

            <div id="reportCard" class="hidden">
                <div id="analysisResult"></div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button class="btn download" onclick="downloadPDF()">üìÑ –¢–æ–ª—ã“õ –•–∞—Ç—Ç–∞–º–∞ (PDF)</button>
                    <button class="btn audio-btn" onclick="downloadAudio()">üéµ –ê—É–¥–∏–æ–∂–∞–∑–±–∞ (MP3)</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let audioContext, analyser, microphone, javascriptNode, mediaRecorder;
        let isRecording = false;
        let timelineData = []; // –£–∞“õ—ã—Ç —à–∫–∞–ª–∞—Å—ã
        let audioChunks = [], audioBlob = null;
        let teacherName="", subjectName="", className="", topicName="";
        let startTime = 0; // –°–∞–±–∞“õ –±–∞—Å—Ç–∞–ª“ì–∞–Ω —É–∞“õ—ã—Ç
	let speakingStart = null; // —Å”©–π–ª–µ—É –±–∞—Å—Ç–∞–ª“ì–∞–Ω —É–∞“õ—ã—Ç

        function saveData() {
            teacherName = document.getElementById('teacherNameInput').value;
            subjectName = document.getElementById('subjectInput').value;
            className = document.getElementById('gradeInput').value;
            topicName = document.getElementById('topicInput').value;

            if(!teacherName || !subjectName || !topicName) { alert("–ë–∞—Ä–ª—ã“õ –∂–æ–ª–∞“õ—Ç—ã —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑!"); return; }

            document.getElementById('displayTeacher').innerText = teacherName;
            document.getElementById('displaySubject').innerText = `${subjectName} (${className})`;
            document.getElementById('displayTopic').innerText = topicName;
            
            document.getElementById('loginModal').style.display = "none";
            document.getElementById('mainContainer').classList.remove("blur");
            document.getElementById('mainContainer').style.pointerEvents = "all";
            document.getElementById('startBtn').disabled = false;
        }

        async function startAnalysis() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // –î–∏–∫—Ç–æ—Ñ–æ–Ω
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
                mediaRecorder.start();

                // –¢–∞–ª–¥–∞—É—à—ã
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);
                
                analyser.fftSize = 2048;
                microphone.connect(analyser);
                analyser.connect(javascriptNode);
                javascriptNode.connect(audioContext.destination);

                isRecording = true; timelineData = []; startTime = Date.now();
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('reportCard').classList.add('hidden');

                const canvas = document.getElementById('audioVisualizer');
                const ctx = canvas.getContext('2d');
                const indicator = document.getElementById('speakerIndicator');

                javascriptNode.onaudioprocess = () => {
                    if (!isRecording) return;
                    const array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);

                    let values = 0, maxIndex = 0, maxVal = 0;
                    for (let i = 0; i < array.length; i++) {
                        values += array[i];
                        if(array[i] > maxVal) { maxVal = array[i]; maxIndex = i; }
                    }
                    const volume = values / array.length;
                    const frequency = maxIndex * (audioContext.sampleRate / analyser.fftSize);

                    // --- –¢–ê–õ–î–ê–£ –õ–û–ì–ò–ö–ê–°–´ (–ú–ê“¢–´–ó–î–´ –ñ–ï–†–Ü) ---
                    let status = "silence";
                    let label = "";
                    let cssClass = "";

                    // 1. –ñ–ï–ö–ï –ñ“∞–ú–´–° (–¢—ã–Ω—ã—à—Ç—ã“õ –Ω–µ–º–µ—Å–µ ”©—Ç–µ —Ç”©–º–µ–Ω –¥—ã–±—ã—Å)
                    if (volume < 15) {
                        status = "individual";
                        label = "üìù –ñ–µ–∫–µ –∂“±–º—ã—Å / –¢—ã–Ω—ã—à—Ç—ã“õ";
                        cssClass = "speaker-box individual-mode";
                    } 
                    // 2. –¢–û–ü–¢–´“ö –ñ“∞–ú–´–° (–î—ã–±—ã—Å “õ–∞—Ç—Ç—ã, –±—ñ—Ä–∞“õ –Ω–∞“õ—Ç—ã —Å”©–∑ –µ–º–µ—Å - –®—É)
                    else if (volume > 45 && frequency > 300) { 
                        status = "group";
                        label = "üë• –¢–æ–ø—Ç—ã“õ –∂“±–º—ã—Å (–¢–∞–ª“õ—ã–ª–∞—É)";
                        cssClass = "speaker-box group-mode";
                    }
                   const now = Date.now();

/* 1Ô∏è‚É£ –ñ–ï–ö–ï –ñ“∞–ú–´–° / –¢–´–ù–´–®–¢–´“ö */
if (volume < 15) {
    speakingStart = null;
    status = "individual";
    label = "üìù –ñ–µ–∫–µ –∂“±–º—ã—Å / –¢—ã–Ω—ã—à—Ç—ã“õ";
    cssClass = "speaker-box individual-mode";
}

/* 2Ô∏è‚É£ –°”®–ô–õ–ï–£ –ë–ê–°–¢–ê–õ–î–´ */
else {
    if (!speakingStart) speakingStart = now;
    const duration = (now - speakingStart) / 1000;

    /* 3Ô∏è‚É£ –¢–û–ü–¢–´“ö –ñ“∞–ú–´–° */
    if (volume > 45 && frequency > 300) {
        status = "group";
        label = "üë• –¢–æ–ø—Ç—ã“õ –∂“±–º—ã—Å (–¢–∞–ª“õ—ã–ª–∞—É)";
        cssClass = "speaker-box group-mode";
    }

    /* 4Ô∏è‚É£ –ú“∞“í–ê–õ–Ü–ú (5 —Å–µ–∫—É–Ω–¥—Ç–∞–Ω “±–∑–∞“õ, —Ç“±—Ä–∞“õ—Ç—ã) */
    else if (duration >= 5) {
        status = "teacher";
        label = "üë®‚Äçüè´ –ú“±“ì–∞–ª—ñ–º —Å”©–π–ª–µ—É–¥–µ";
        cssClass = "speaker-box teacher-mode";
    }

    /* 5Ô∏è‚É£ –û“ö–£–®–´ (“õ—ã—Å“õ–∞ –∂–∞—É–∞–ø) */
    else {
        status = "student";
        label = "üôã‚Äç‚ôÇÔ∏è –û“õ—É—à—ã –∂–∞—É–∞–±—ã / –ñ“±–ø—Ç—ã“õ –∂“±–º—ã—Å";
        cssClass = "speaker-box student-mode";
    }
}

indicator.innerText = label;
indicator.className = cssClass;

                    indicator.innerText = label;
                    indicator.className = cssClass;

                    // –î–µ—Ä–µ–∫ –∂–∏–Ω–∞—É (1 —Å–µ–∫—É–Ω–¥ —Å–∞–π—ã–Ω)
                    if(Math.random() > 0.95) {
                        timelineData.push({
                            time: (Date.now() - startTime) / 1000, // –°–µ–∫—É–Ω–¥
                            type: status
                        });
                    }

                    // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    let x = 0; const barWidth = (canvas.width / array.length) * 2.5;
                    for (let i = 0; i < array.length; i++) {
                        ctx.fillStyle = `rgb(${volume*2}, ${150}, 250)`; // –¢“Ø—Å—ñ –¥—ã–±—ã—Å“õ–∞ “õ–∞—Ä–∞–π ”©–∑–≥–µ—Ä–µ–¥—ñ
                        ctx.fillRect(x, canvas.height - array[i]/2, barWidth, array[i]/2);
                        x += barWidth + 1;
                    }
                };

            } catch (err) { alert("–ú–∏–∫—Ä–æ—Ñ–æ–Ω “õ–∞—Ç–µ—Å—ñ!"); }
        }

        function stopAnalysis() {
            isRecording = false;
            audioContext.close();
            mediaRecorder.stop();
            mediaRecorder.onstop = () => { audioBlob = new Blob(audioChunks, { type: 'audio/webm' }); };

            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('speakerIndicator').innerText = "‚úÖ –¢–∞–ª–¥–∞—É –∞—è“õ—Ç–∞–ª–¥—ã";
            const lessonDuration = (Date.now() - startTime) / 1000;

if (lessonDuration < 40 * 60) {
    document.getElementById('reportCard').classList.remove('hidden');
    document.getElementById('analysisResult').innerHTML = `
        <h3 style="color:#c0392b;">‚ùå –°–∞–±–∞“õ —Ç–∞–ª–¥–∞–Ω–±–∞–¥—ã</h3>
        <p>–°–∞–±–∞“õ “±–∑–∞“õ—Ç—ã“ì—ã: ${Math.round(lessonDuration / 60)} –º–∏–Ω—É—Ç</p>
        <p><b>–ï—Ä–µ–∂–µ:</b> –°–∞–±–∞“õ –∫–µ–º—ñ–Ω–¥–µ 40 –º–∏–Ω—É—Ç –±–æ–ª—É—ã –∫–µ—Ä–µ–∫.</p>
    `;
    return;
}

            generateSmartReport();
        }

        function formatTime(sec) {
            sec = Math.round(sec);
            let m = Math.floor(sec/60), s = sec%60;
            return m===0 ? `${s} —Å–µ–∫` : `${m} –º–∏–Ω ${s} —Å–µ–∫`;
        }

        // --- –ù–ê“ö–¢–´ –¢–ê–õ–î–ê–£ –ñ–ê–°–ê–£ –§–£–ù–ö–¶–ò–Ø–°–´ ---
        function generateSmartReport() {
            const reportCard = document.getElementById('reportCard');
            reportCard.classList.remove('hidden');

            // –°–∞–Ω–∞—É
            let counts = { teacher: 0, student: 0, group: 0, individual: 0 };
            timelineData.forEach(d => counts[d.type]++);
            let total = timelineData.length;
            if (total === 0) total = 1;

            // –£–∞“õ—ã—Ç—Ç—ã –±”©–ª—É (–ë–∞—Å—ã, –û—Ä—Ç–∞—Å—ã, –°–æ“£—ã)
            const part = Math.floor(total/3);
            const startData = timelineData.slice(0, part);
            const midData = timelineData.slice(part, part*2);
            const endData = timelineData.slice(part*2, total);

            // 1. –°–ê–ë–ê“ö –ë–ê–°–´–ù –¢–ê–õ–î–ê–£
            let startComment = "";
            let startTeacher = startData.filter(d => d.type === 'teacher').length;
            if (startTeacher > part * 0.6) {
                startComment = "‚úÖ –°–∞–±–∞“õ –º“±“ì–∞–ª—ñ–º–Ω—ñ“£ “±–π—ã–º–¥–∞—Å—Ç—ã—Ä—É —Å”©–∑—ñ–º–µ–Ω, –º–∞“õ—Å–∞—Ç “õ–æ—é—ã–º–µ–Ω –±–∞—Å—Ç–∞–ª–¥—ã. –ë“±–ª –¥“±—Ä—ã—Å.";
            } else {
                startComment = "‚ö†Ô∏è –°–∞–±–∞“õ—Ç—ã“£ –∫—ñ—Ä—ñ—Å–ø–µ –±”©–ª—ñ–º—ñ ”©—Ç–µ “õ—ã—Å“õ–∞ –±–æ–ª–¥—ã –Ω–µ–º–µ—Å–µ –±—ñ—Ä–¥–µ–Ω —à—É–ª—ã –∂“±–º—ã—Å –±–∞—Å—Ç–∞–ª–¥—ã.";
            }

            // 2. –ù–ï–ì–Ü–ó–ì–Ü –ë”®–õ–Ü–ú–î–Ü –¢–ê–õ–î–ê–£ (”ò–¥—ñ—Å-—Ç”ô—Å—ñ–ª–¥–µ—Ä)
            let midComment = "";
            let midGroup = midData.filter(d => d.type === 'group').length;
            let midIndiv = midData.filter(d => d.type === 'individual').length;
            let methodDetected = "–ê—Ä–∞–ª–∞—Å ”ô–¥—ñ—Å";

            if (midGroup > part * 0.3) {
                midComment = "üë• –°–∞–±–∞“õ—Ç—ã“£ –æ—Ä—Ç–∞—Å—ã–Ω–¥–∞ –∂–æ“ì–∞—Ä—ã –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ –±–∞–π“õ–∞–ª–¥—ã. <b>–¢–æ–ø—Ç—ã“õ –∂“±–º—ã—Å (Group Work)</b> –Ω–µ–º–µ—Å–µ “õ—ã–∑—É —Ç–∞–ª“õ—ã–ª–∞—É –∂“Ø—Ä–≥—ñ–∑—ñ–ª–¥—ñ. –û“õ—É—à—ã–ª–∞—Ä –±—ñ—Ä-–±—ñ—Ä—ñ–º–µ–Ω —Å”©–π–ª–µ—Å—Ç—ñ.";
                methodDetected = "–¢–æ–ø—Ç—ã“õ –∂“±–º—ã—Å / –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤—Ç—ñ –æ“õ—ã—Ç—É";
            } else if (midIndiv > part * 0.4) {
                midComment = "üìù –°–∞–±–∞“õ—Ç—ã“£ –æ—Ä—Ç–∞—Å—ã–Ω–¥–∞ “±–∑–∞“õ —Ç—ã–Ω—ã—à—Ç—ã“õ –æ—Ä–Ω–∞–¥—ã. –ë“±–ª –æ“õ—É—à—ã–ª–∞—Ä–¥—ã“£ <b>–ñ–µ–∫–µ –∂“±–º—ã—Å (Individual Work)</b> –æ—Ä—ã–Ω–¥–∞“ì–∞–Ω—ã–Ω –±—ñ–ª–¥—ñ—Ä–µ–¥—ñ (–µ—Å–µ–ø —à—ã“ì–∞—Ä—É, –∂–∞–∑—É).";
                methodDetected = "–°–∞—Ä–∞–ª–∞–ø –æ“õ—ã—Ç—É / –ñ–µ–∫–µ –∂“±–º—ã—Å";
            } else {
                midComment = "üó£ –°–∞–±–∞“õ –Ω–µ–≥—ñ–∑—ñ–Ω–µ–Ω —Å“±—Ä–∞“õ-–∂–∞—É–∞–ø –∂”ô–Ω–µ –º“±“ì–∞–ª—ñ–º–Ω—ñ“£ —Ç“Ø—Å—ñ–Ω–¥—ñ—Ä—É—ñ–º–µ–Ω ”©—Ç—Ç—ñ.";
                methodDetected = "–î–∏–∞–ª–æ–≥—Ç—ã“õ –æ“õ—ã—Ç—É";
            }

            // 3. “ö–û–†–´–¢–´–ù–î–´–ù–´ –¢–ê–õ–î–ê–£
            let endComment = "";
            let endTeacher = endData.filter(d => d.type === 'teacher').length;
            if (endTeacher > 0) {
                endComment = "‚úÖ –°–∞–±–∞“õ —Å–æ“£—ã–Ω–¥–∞ –º“±“ì–∞–ª—ñ–º “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã –∂–∞—Å–∞–ø, –±–∞“ì–∞–ª–∞—É –∂“Ø—Ä–≥—ñ–∑–¥—ñ.";
            } else {
                endComment = "‚ö†Ô∏è –°–∞–±–∞“õ –∫—ñ–ª—Ç “Ø–∑—ñ–ª–¥—ñ. “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã–ª–∞—É“ì–∞ —É–∞“õ—ã—Ç –∂–µ—Ç–ø–µ–≥–µ–Ω –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω.";
            }

            // PDF –ú–ê–ó–ú“∞–ù–´
            document.getElementById('analysisResult').innerHTML = `
                <div style="padding: 20px; font-family: 'Times New Roman', serif;">
                    <h2 style="text-align:center; text-transform:uppercase; margin:0;">–°–∞–±–∞“õ—Ç—ã —Ç–∞–ª–¥–∞—É —Ö–∞—Ç—Ç–∞–º–∞—Å—ã</h2>
                    <p style="text-align:center; font-style:italic;">Education Black Box —Å–∞—Ä–∞–ø—Ç–∞–º–∞—Å—ã</p>
                    <hr>
                    
                    <table style="width:100%; border-collapse:collapse; margin-bottom:20px;">
                        <tr><td><b>–ö“Ø–Ω—ñ:</b> ${new Date().toLocaleDateString()}</td> <td><b>–ú“±“ì–∞–ª—ñ–º:</b> ${teacherName}</td></tr>
                        <tr><td><b>–ü”ô–Ω:</b> ${subjectName} (${className})</td> <td><b>–¢–∞“õ—ã—Ä—ã–ø:</b> ${topicName}</td></tr>
                    </table>

                    <div class="report-title">I. –°–∞–±–∞“õ —Ñ–æ—Ä–º–∞–ª–∞—Ä—ã–Ω—ã“£ “Ø–ª–µ—Å—ñ (–î–∏–∞–≥—Ä–∞–º–º–∞ –æ—Ä–Ω—ã–Ω–∞)</div>
                    <ul style="line-height:1.8;">
                        <li>üë®‚Äçüè´ <b>–ú“±“ì–∞–ª—ñ–º —Å”©–∑—ñ:</b> ${Math.round((counts.teacher/total)*100)}% (–¢“Ø—Å—ñ–Ω–¥—ñ—Ä—É, –Ω“±—Å“õ–∞—É)</li>
                        <li>üë• <b>–¢–æ–ø—Ç—ã“õ –∂“±–º—ã—Å:</b> ${Math.round((counts.group/total)*100)}% (–¢–∞–ª“õ—ã–ª–∞—É, —à—É)</li>
                        <li>üìù <b>–ñ–µ–∫–µ –∂“±–º—ã—Å:</b> ${Math.round((counts.individual/total)*100)}% (–¢—ã–Ω—ã—à—Ç—ã“õ)</li>
                        <li>üôã‚Äç‚ôÇÔ∏è <b>–î–∏–∞–ª–æ–≥/–ñ“±–ø—Ç—ã“õ:</b> ${Math.round((counts.student/total)*100)}% (–°“±—Ä–∞“õ-–∂–∞—É–∞–ø)</li>
                    </ul>

                    <div class="report-title" style="margin-top:20px;">II. –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è–ª—ã“õ —Ç–∞–ª–¥–∞—É (–ù–∞“õ—Ç—ã –Ω–µ –±–æ–ª–¥—ã?)</div>
                    
                    <div class="timeline-item">
                        <b>1. –ö—ñ—Ä—ñ—Å–ø–µ –±”©–ª—ñ–º:</b><br>
                        ${startComment}
                    </div>
                    <br>
                    <div class="timeline-item">
                        <b>2. –ù–µ–≥—ñ–∑–≥—ñ –±”©–ª—ñ–º (”ò–¥—ñ—Å-—Ç”ô—Å—ñ–ª–¥–µ—Ä):</b><br>
                        ${midComment}
                    </div>
                    <br>
                    <div class="timeline-item">
                        <b>3. “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã –±”©–ª—ñ–º:</b><br>
                        ${endComment}
                    </div>

                    <div class="report-title" style="margin-top:20px;">III. AI “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã—Å—ã</div>
                    <p>–ê–Ω—ã“õ—Ç–∞–ª“ì–∞–Ω –±–∞—Å—ã–º ”ô–¥—ñ—Å: <b>${methodDetected}</b></p>
                    
                    <br><br>
                    <table style="width:100%; margin-top:40px;">
                        <tr><td style="text-align:center;">___________________<br>–ú“±“ì–∞–ª—ñ–º</td>
                        <td style="text-align:center;">___________________<br>–°–∞—Ä–∞–ø—à—ã</td></tr>
                    </table>
                </div>
            `;
        }

        function downloadPDF() {
            const element = document.getElementById('analysisResult');
            const opt = {
                margin: 10, filename: `–¢–∞–ª–¥–∞—É_${teacherName}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0, windowHeight: element.scrollHeight + 100 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
                pagebreak: { mode: ['css', 'legacy'] }
            };
            html2pdf().set(opt).from(element).save();
        }

        function downloadAudio() {
            if(!audioBlob) return alert("–ê—É–¥–∏–æ –∂–æ“õ");
            const url = URL.createObjectURL(audioBlob);
            const a = document.createElement('a');
            a.href = url; a.download = `Audio_${teacherName}.webm`;
            a.click();
        }
    </script>
</body>
</html>